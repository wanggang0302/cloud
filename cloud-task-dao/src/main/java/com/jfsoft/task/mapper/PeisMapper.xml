<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jfsoft.task.mapper.PeisMapper" >

    <resultMap type="com.jfsoft.task.entity.PerCheckinfo" id="perCheckInfoList">
        <id column="id" property="id" />
        <result column="testno" property="testno" />
        <result column="recodeno" property="recodeno" />
        <result column="name" property="name" />
        <result column="pycode" property="pycode" />
        <result column="sex" property="sex" />
        <result column="age" property="age" />
        <result column="ageunitcode" property="ageunitcode" />
        <result column="areacode" property="areacode" />
    </resultMap>
    <resultMap type="com.jfsoft.task.entity.PerGroupitem" id="perGroupItemList">
        <id column="id" property="id" />
        <result column="testno" property="testno" />
        <result column="testno" property="testno" />
        <result column="groupcode" property="groupcode" />
        <result column="groupname" property="groupname" />
        <result column="groupmoney" property="groupmoney" />
        <result column="groupagiomoney" property="groupagiomoney" />
        <result column="discount" property="discount" />
        <result column="statuscode" property="statuscode" />
        <result column="recordtime" property="recordtime" />
        <result column="isoncredit" property="isoncredit" />
        <result column="areacode" property="areacode" />
    </resultMap>

    <!-- 根据存储过程查询体检者信息 -->
    <select id="getPerCheckInfoProc" parameterType="java.util.Map" statementType="CALLABLE">
        {call rpt_barcode(
        #{testno,jdbcType=VARCHAR,mode=IN},
        #{areacode,jdbcType=VARCHAR,mode=IN},
        #{cur_arg_per,jdbcType=CURSOR,javaType=ResultSet, mode=OUT,resultMap=perCheckInfoList},
        #{cur_arg_item,jdbcType=CURSOR,javaType=ResultSet, mode=OUT,resultMap=perGroupItemList}
        )}
    </select>

    <!-- 调用生成TestNo的存储过程 -->
    <select id="getTestNo" parameterType="java.util.Map" statementType="CALLABLE">
        {call mdl_testno(
        #{areacode,jdbcType=VARCHAR,mode=IN},
        #{usercode,jdbcType=VARCHAR,mode=IN},
        #{testno,jdbcType=VARCHAR,mode=OUT}
        )}
    </select>

    <!-- 调用存储过程，返回体检者信息 -->
    <select id="getPerCheckinfoList" parameterType="java.util.Map" statementType="CALLABLE">
        {call RPT_PER_CHECKINFO(
            #{area_code,jdbcType=VARCHAR,mode=IN},
            #{rowlimit,jdbcType=DECIMAL,mode=IN},
            #{cur_arg_per,jdbcType=CURSOR,javaType=ResultSet, mode=OUT,resultMap=perCheckInfoList}
        )}
    </select>
    <insert id="saveTag_Id" parameterType="java.lang.String" statementType="CALLABLE">

        insert into test_tag(id,tagid) values (sys_guid(), #{testno})


    </insert>

</mapper>
